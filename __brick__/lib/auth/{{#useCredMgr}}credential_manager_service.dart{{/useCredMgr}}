import 'dart:developer';

import 'package:credential_manager/credential_manager.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:get/get.dart';

class CredentialManagerService extends GetxService {
  final CredentialManager credentialManager = CredentialManager();

  @override
  void onInit() async {
    super.onInit();
    if (credentialManager.isSupportedPlatform) {
      await credentialManager.init(
        preferImmediatelyAvailableCredentials: true,
        googleClientId: '{{googleClientId}}',
      );
    }
  }

  Future<OAuthCredential?> signInWithGoogle({required bool useButtonFlow}) async {
    try {
      final GoogleIdTokenCredential? credential = await credentialManager
          .saveGoogleCredential(useButtonFlow: useButtonFlow);

      if (credential == null) return null;

      final googleAuthCredential = GoogleAuthProvider.credential(
        idToken: credential.idToken,
      );

      return googleAuthCredential;
    } catch (e) {
      log('Google Sign-In failed: $e');
      return null;
    }
  }
}
